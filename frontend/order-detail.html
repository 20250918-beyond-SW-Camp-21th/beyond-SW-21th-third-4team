<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문상세 :: INSILENCE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-size-xs: 10px;
            --font-size-small: 11px;
            --font-size-medium: 13px;
            --font-size-large: 16px;
            --color-primary: #000;
            --color-secondary: #757575;
            --color-border: #e0e0e0;
            --color-bg: #fff;
            --color-bg-alt: #f9f9f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-primary);
            font-size: var(--font-size-medium);
            font-weight: 300;
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            font-family: 'Noto Sans KR', sans-serif;
            cursor: pointer;
        }

        /* Top Utility Bar */
        .top-utility {
            height: 32px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 40px;
            font-size: var(--font-size-small);
        }

        .top-utility-menu {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .top-utility-menu a,
        .top-utility-menu button {
            background: none;
            border: none;
            color: var(--color-secondary);
            font-size: var(--font-size-small);
            padding: 0;
        }

        .top-utility-menu a:hover,
        .top-utility-menu button:hover {
            color: var(--color-primary);
        }

        .divider {
            color: var(--color-border);
        }

        /* Header */
        header {
            border-bottom: 1px solid var(--color-border);
            background: var(--color-bg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 40px;
            height: 70px;
        }

        .logo {
            font-size: 20px;
            font-weight: 400;
            letter-spacing: 3px;
        }

        .main-nav {
            display: flex;
            gap: 35px;
            font-size: var(--font-size-medium);
        }

        .main-nav a {
            color: var(--color-primary);
            font-weight: 300;
        }

        .main-nav a:hover {
            font-weight: 400;
        }

        .header-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-icons button {
            background: none;
            border: none;
            font-size: var(--font-size-medium);
            color: var(--color-primary);
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        .page-title {
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 50px;
            letter-spacing: 1px;
            text-align: center;
        }

        .back-button {
            margin-bottom: 30px;
        }

        .btn-back {
            background: var(--color-bg);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
            padding: 10px 20px;
            font-size: var(--font-size-small);
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .btn-back:hover {
            background: var(--color-primary);
            color: var(--color-bg);
        }

        /* Section */
        .detail-section {
            margin-bottom: 50px;
            border: 1px solid var(--color-border);
            padding: 40px;
        }

        .section-title {
            font-size: var(--font-size-large);
            font-weight: 400;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-primary);
            letter-spacing: 1px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 20px;
            font-size: var(--font-size-medium);
        }

        .info-label {
            color: var(--color-secondary);
            font-weight: 400;
        }

        .info-value {
            color: var(--color-primary);
        }

        /* Product Table */
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            padding: 15px;
            font-size: var(--font-size-small);
            font-weight: 400;
            color: var(--color-primary);
            text-align: center;
            border-top: 1px solid var(--color-primary);
            border-bottom: 1px solid var(--color-border);
            background: var(--color-bg-alt);
        }

        .products-table td {
            padding: 20px 15px;
            font-size: var(--font-size-small);
            color: var(--color-primary);
            text-align: center;
            border-bottom: 1px solid var(--color-border);
        }

        .product-name {
            text-align: left;
        }

        /* Loading & Error */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-secondary);
            font-size: var(--font-size-small);
        }

        .error {
            background: transparent;
            color: var(--color-primary);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--color-primary);
            font-size: var(--font-size-small);
        }

        .hidden {
            display: none;
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--color-border);
            padding: 40px;
            background: var(--color-bg);
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: var(--font-size-small);
        }

        .footer-links a {
            color: var(--color-secondary);
        }

        .footer-links a:hover {
            color: var(--color-primary);
        }

        .footer-info {
            font-size: var(--font-size-small);
            color: var(--color-secondary);
            line-height: 1.8;
        }

        .footer-info p {
            margin-bottom: 5px;
        }

        .footer-social {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .footer-social a {
            color: var(--color-secondary);
            font-size: var(--font-size-small);
        }
    </style>
</head>
<body>
    <!-- Top Utility Bar -->
    <div class="top-utility">
        <div class="top-utility-menu">
            <button>KOREAN</button>
            <span class="divider">|</span>
            <button>고객센터</button>
            <span class="divider">|</span>
            <button>공지사항</button>
            <span class="divider">|</span>
            <a href="mypage.html">마이페이지</a>
            <span class="divider">|</span>
            <button>장바구니 (0)</button>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-inner">
            <a href="#" class="logo">INSILENCE</a>
            <nav class="main-nav">
                <a href="#">남성복</a>
                <a href="#">여성복</a>
                <a href="#">CLEARANCE</a>
                <a href="#">컬렉션</a>
                <a href="#">컨텐츠</a>
                <a href="#">매장안내</a>
            </nav>
            <div class="header-icons">
                <button>검색</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <h1 class="page-title">주문상세</h1>

        <div class="back-button">
            <button class="btn-back" onclick="goBack()">← 목록으로</button>
        </div>

        <div id="loadingDiv" class="loading">주문 정보를 불러오는 중...</div>
        <div id="errorDiv" class="error hidden"></div>

        <div id="orderDetailContent" class="hidden">
            <!-- Order Information -->
            <div class="detail-section">
                <h2 class="section-title">주문정보</h2>
                <div class="info-grid">
                    <div class="info-label">주문번호</div>
                    <div class="info-value" id="orderId">-</div>

                    <div class="info-label">주문일자</div>
                    <div class="info-value" id="orderedAt">-</div>

                    <div class="info-label">주문상태</div>
                    <div class="info-value" id="orderStatus">-</div>

                    <div class="info-label">총 주문금액</div>
                    <div class="info-value" id="totalPrice">-</div>
                </div>
            </div>

            <!-- Delivery Information -->
            <div class="detail-section">
                <h2 class="section-title">배송정보</h2>
                <div class="info-grid">
                    <div class="info-label">수령인</div>
                    <div class="info-value" id="receiverName">-</div>

                    <div class="info-label">연락처</div>
                    <div class="info-value" id="receiverPhone">-</div>

                    <div class="info-label">배송지</div>
                    <div class="info-value" id="address">-</div>

                    <div class="info-label">배송메시지</div>
                    <div class="info-value" id="deliveryMessage">-</div>
                </div>
            </div>

            <!-- Product Information -->
            <div class="detail-section">
                <h2 class="section-title">주문상품</h2>
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>상품정보</th>
                            <th>수량</th>
                            <th>상품금액</th>
                        </tr>
                    </thead>
                    <tbody id="orderItems">
                        <!-- Product items will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="#">이용약관</a>
                <a href="#">개인정보처리방침</a>
            </div>
            <div class="footer-info">
                <p><strong>AMBIENT CO.LTD.</strong></p>
                <p>고객센터: 1670-0133 (평일 10:00-18:00, 점심 11:30-12:30)</p>
                <p>서울시 성동구 상원1길 26 서울숲 에이타워 15층</p>
                <p>사업자등록번호: 217-86-00349 | 통신판매업신고: 2016-서울성동-00425</p>
                <p>이메일: cs@insilence.co.kr</p>
                <p style="margin-top: 15px;">© 2024 AMBIENT</p>
            </div>
            <div class="footer-social">
                <a href="#">Instagram</a>
                <a href="#">YouTube</a>
            </div>
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api/v1';
        let authToken = localStorage.getItem('authToken');

        // Get orderId from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (!authToken) {
                alert('로그인이 필요합니다.');
                window.location.href = 'mypage.html';
                return;
            }

            if (!orderId) {
                showError('주문번호가 없습니다.');
                return;
            }

            loadOrderDetail();
        });

        // Load order detail
        async function loadOrderDetail() {
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            const contentDiv = document.getElementById('orderDetailContent');

            showLoading(loadingDiv);
            hideError(errorDiv);
            contentDiv.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/mypage/orders/${orderId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    displayOrderDetail(result.data);
                    hideLoading(loadingDiv);
                    contentDiv.classList.remove('hidden');
                } else {
                    hideLoading(loadingDiv);
                    showError(errorDiv, result.error.message || '주문 정보를 불러올 수 없습니다.');
                }
            } catch (error) {
                console.error('Load order detail error:', error);
                hideLoading(loadingDiv);
                showError(errorDiv, '서버 연결 실패');
            }
        }

        // Display order detail
        function displayOrderDetail(order) {
            document.getElementById('orderId').textContent = order.orderId;
            document.getElementById('orderedAt').textContent = formatDateTime(order.orderedAt);
            document.getElementById('orderStatus').textContent = getStatusText(order.status);
            document.getElementById('totalPrice').textContent = formatPrice(order.totalPrice) + '원';
            document.getElementById('receiverName').textContent = order.receiverName;
            document.getElementById('receiverPhone').textContent = order.receiverPhone;
            document.getElementById('address').textContent = order.address;
            document.getElementById('deliveryMessage').textContent = order.deliveryMessage || '없음';

            // Display order items
            const itemsBody = document.getElementById('orderItems');
            if (order.items && order.items.length > 0) {
                itemsBody.innerHTML = order.items.map(item => `
                    <tr>
                        <td class="product-name">상품 ID: ${item.productId}</td>
                        <td>${item.quantity}</td>
                        <td>${formatPrice(item.totalPrice)}원</td>
                    </tr>
                `).join('');
            } else {
                itemsBody.innerHTML = '<tr><td colspan="3">주문 상품 정보가 없습니다.</td></tr>';
            }
        }

        // Go back to order list
        function goBack() {
            window.location.href = 'mypage.html';
        }

        // Helper functions
        function getStatusText(status) {
            const statusMap = {
                'PAYMENT_COMPLETED': '결제완료',
                'PREPARING': '배송준비중',
                'SHIPPING': '배송중',
                'DELIVERED': '배송완료',
                'CANCELLED': '취소'
            };
            return statusMap[status] || status;
        }

        function formatDateTime(dateTimeStr) {
            if (!dateTimeStr) return '-';
            const date = new Date(dateTimeStr);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function showLoading(element) {
            element.classList.remove('hidden');
        }

        function hideLoading(element) {
            element.classList.add('hidden');
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(element) {
            element.classList.add('hidden');
        }
    </script>
</body>
</html>
